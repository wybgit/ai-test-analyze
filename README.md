# AI-Test-Analyze: AI 驱动的日志分析工具

`ai-test-analyze` 是一个专业的命令行工具，它利用大语言模型（LLM）的强大能力，通过多线程并发，快速分析指定的测试日志文件，并生成一个结构化、可配置、可选格式的动态分析报告。

## 核心功能

- **快速路径分析 (Fast Path Analysis)**:
    - 在 `config.json` 中新增 `fast_success_regex` 和 `fast_failure_regex` 选项，它们现在是**正则表达式列表**。
    - 如果日志内容匹配列表中的**任何一个**正则表达式，程序将**立即**判定结果，**无需调用大语言模型**，极大地提升了对明确日志的分析速度并节省了API成本。
- **智能分析**:
    - **聚焦关键信息**: 默认只分析每个日志文件的**最后 8KB 内容**。
    - **高级问题分类**: Prompt 指导 LLM 将失败原因区分为 **【环境问题】** 或 **【软件缺陷】**。
    - **例外模式匹配**: `exception_pattern.template` 可以定义应被忽略的特定模式。
- **信息完备的报告**:
    - 新增 **`Extracted Log Content`** 列，在报告中直接展示用于分析的原始日���片段。
- **鲁棒的执行过程**:
    - **周期性保存**: 在处理大量文件时，程序会周期性地保存报告，有效防止因意外中断造成的数据丢失。
- **开箱即用**: 项目内置 `example` 目录，包含丰富的示例日志。
- **子命令结构**:
    - `run`: 执行核心的分析任务。
    - `config`: 快速显示所有配置和模板文件的路径。
- **强大的过滤功能**:
    - 通过 `config.json` 文件，同时支持**白名单**和**黑名单**规则。
- **多线程并发分析**: 通过 `--threads` 参数指定线程数（默认为8）。
- **自动初始化**: 首次运行时，所有必需的配置文件和模板都会自动在您的用户主目录中创建。

## 安装

在项目根目录下，运行以下命令进行安装或更新。

```bash
pip install .
```

## 快速开始

### 1. 查看配置

安装后，首先运行 `config` 命令查看所有配置文件的位置。

```bash
ai-test-analyze config
```

### 2. 编辑配置与模板

根据上一步显示的路径，打开 `config.json` 文件：
- **必须填入您的 `api_token`**。
- (可选) 配置 `fast_success_regex` 和 `fast_failure_regex` 列表，以加速常见日志的分析。

**如何书写正则表达式 (Regex) Pattern:**

正则表达式是一种强大的文本匹配工具。下面是一些基本示例，帮助您配置 `fast_..._regex` 列表：

- **匹配任意位置的文本**:
  直接写入文本即可。`"Error"` 会匹配任何包含 "Error" 的日志。为了忽略大小写，可以使用 `(?i)` 标记，例如 `"(?i)error"` 会同时匹配 "error" 和 "ERROR"。

- **匹配结尾的内容**:
  使用 `# AI-Test-Analyze: AI 驱动的日志分析工具

`ai-test-analyze` 是一个专业的命令行工具，它利用大语言模型（LLM）的强大能力，通过多线程并发，快速分析指定的测试日志文件，并生成一个结构化、可配置、可选格式的动态分析报告。

## 核心功能

- **快速路径分析 (Fast Path Analysis)**:
    - 在 `config.json` 中新增 `fast_success_regex` 和 `fast_failure_regex` 选项，它们现在是**正则表达式列表**。
    - 如果日志内容匹配列表中的**任何一个**正则表达式，程序将**立即**判定结果，**无需调用大语言模型**，极大地提升了对明确日志的分析速度并节省了API成本。
- **智能分析**:
    - **聚焦关键信息**: 默认只分析每个日志文件的**最后 8KB 内容**。
    - **高级问题分类**: Prompt 指导 LLM 将失败原因区分为 **【环境问题】** 或 **【软件缺陷】**。
    - **例外模式匹配**: `exception_pattern.template` 可以定义应被忽略的特定模式。
- **信息完备的报告**:
    - 新增 **`Extracted Log Content`** 列，在报告中直接展示用于分析的原始日���片段。
- **鲁棒的执行过程**:
    - **周期性保存**: 在处理大量文件时，程序会周期性地保存报告，有效防止因意外中断造成的数据丢失。
- **开箱即用**: 项目内置 `example` 目录，包含丰富的示例日志。
- **子命令结构**:
    - `run`: 执行核心的分析任务。
    - `config`: 快速显示所有配置和模板文件的路径。
- **强大的过滤功能**:
    - 通过 `config.json` 文件，同时支持**白名单**和**黑名单**规则。
- **多线程并发分析**: 通过 `--threads` 参数指定线程数（默认为8）。
- **自动初始化**: 首次运行时，所有必需的配置文件和模板都会自动在您的用户主目录中创建。

## 安装

在项目根目录下，运行以下命令进行安装或更新。

```bash
pip install .
```

## 快速开始

### 1. 查看配置

安装后，首先运行 `config` 命令查看所有配置文件的位置。

```bash
ai-test-analyze config
```

 锚点。`# AI-Test-Analyze: AI 驱动的日志分析工具

`ai-test-analyze` 是一个专业的命令行工具，它利用大语言模型（LLM）的强大能力，通过多线程并发，快速分析指定的测试日志文件，并生成一个结构化、可配置、可选格式的动态分析报告。

## 核心功能

- **快速路径分析 (Fast Path Analysis)**:
    - 在 `config.json` 中新增 `fast_success_regex` 和 `fast_failure_regex` 选项，它们现在是**正则表达式列表**。
    - 如果日志内容匹配列表中的**任何一个**正则表达式，程序将**立即**判定结果，**无需调用大语言模型**，极大地提升了对明确日志的分析速度并节省了API成本。
- **智能分析**:
    - **聚焦关键信息**: 默认只分析每个日志文件的**最后 8KB 内容**。
    - **高级问题分类**: Prompt 指导 LLM 将失败原因区分为 **【环境问题】** 或 **【软件缺陷】**。
    - **例外模式匹配**: `exception_pattern.template` 可以定义应被忽略的特定模式。
- **信息完备的报告**:
    - 新增 **`Extracted Log Content`** 列，在报告中直接展示用于分析的原始日���片段。
- **鲁棒的执行过程**:
    - **周期性保存**: 在处理大量文件时，程序会周期性地保存报告，有效防止因意外中断造成的数据丢失。
- **开箱即用**: 项目内置 `example` 目录，包含丰富的示例日志。
- **子命令结构**:
    - `run`: 执行核心的分析任务。
    - `config`: 快速显示所有配置和模板文件的路径。
- **强大的过滤功能**:
    - 通过 `config.json` 文件，同时支持**白名单**和**黑名单**规则。
- **多线程并发分析**: 通过 `--threads` 参数指定线程数（默认为8）。
- **自动初始化**: 首次运行时，所有必需的配置文件和模板都会自动在您的用户主目录中创建。

## 安装

在项目根目录下，运行以下命令进行安装或更新。

```bash
pip install .
```

## 快速开始

### 1. 查看配置

安装后，首先运行 `config` 命令查看所有配置文件的位置。

```bash
ai-test-analyze config
```

 代表字符串的末尾。例如，`"All tests passed successfully$"` 只会匹配那些**严格以** "All tests passed successfully" 结尾的日志。

- **匹配中间的特定模式**:
  组合使用不同的元字符。例如，要匹配 "task [any number] completed"，您可以使用 `task \d+ completed`。其中 `\d+` 匹配一个或多个数字。

**示例 `config.json` 中的快速路径配置:**
```json
"fast_success_regex": [
    "All tests passed successfully$",
    "^\\s*OK\\s*$",
    "BUILD SUCCESSFUL"
],
"fast_failure_regex": [
    "(?i)error",
    "(?i)fatal",
    "Traceback \\(most recent call last\\):",
    "BUILD FAILED"
]
```

### 3. 执行分析

现在，让我们用 `run` 命令来分析 `example` 目录。

```bash
ai-test-analyze run ./example --format xlsx
```

程序会：
1.  扫描 `example` 目录。
2.  对每个日志，**首先尝试匹配快速路径规则列表**。如果匹配，则立即记录结果。
3.  对于不匹配的日志，启动多线程并发，交由大语言模型进行分析。
4.  在当前目录下生成一个精美的 Excel 报告。

## 命令行

### `ai-test-analyze run [OPTIONS]`
执行分析任务。
- `path`: 要分析的日志文件或目录的路径。
- `--output`: *可选*。指定输出报告的路径和名称（无需后缀）。
- `--threads`: *可选*。并发分析的线程数。默认为 `8`。
- `--format`: *可选*。输出报告的格式，可选值为 `csv` 或 `xlsx`。默认为 `csv`。
- `--resume`: *可选*。指定一个报告文件以恢复分析。
- `--debug`: *可选*。激活调试模式。

### `ai-test-analyze config`
显示所有配置和模板文件的路径。